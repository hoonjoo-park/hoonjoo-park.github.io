<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>setState의 비동기적 특성과 Dependency - Hoon&#039;s 블로그</title><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="#3273dc"><meta name="application-name" content="Hoon"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="msapplication-TileColor" content="#3273dc"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Hoon"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="🐤 setState의 특성"><meta property="og:type" content="blog"><meta property="og:title" content="setState의 비동기적 특성과 Dependency"><meta property="og:url" content="https://hoonjoo-park.github.io/react/setStateAsync/"><meta property="og:site_name" content="Hoon&#039;s 블로그"><meta property="og:description" content="🐤 setState의 특성"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://user-images.githubusercontent.com/67448481/154808670-f614787d-7816-4dc9-8730-9bf8388fc5d4.png"><meta property="article:published_time" content="2022-02-19T16:05:40.000Z"><meta property="article:modified_time" content="2022-02-19T16:05:49.059Z"><meta property="article:author" content="Hoonjoo"><meta property="article:tag" content="개념"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="https://user-images.githubusercontent.com/67448481/154808670-f614787d-7816-4dc9-8730-9bf8388fc5d4.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://hoonjoo-park.github.io/react/setStateAsync/"},"headline":"setState의 비동기적 특성과 Dependency","image":["https://user-images.githubusercontent.com/67448481/154808670-f614787d-7816-4dc9-8730-9bf8388fc5d4.png"],"datePublished":"2022-02-19T16:05:40.000Z","dateModified":"2022-02-19T16:05:49.059Z","author":{"@type":"Person","name":"Hoonjoo"},"publisher":{"@type":"Organization","name":"Hoon's 블로그","logo":{"@type":"ImageObject","url":"https://hoonjoo-park.github.io/img/logo.svg"}},"description":"🐤 setState의 특성"}</script><link rel="canonical" href="https://hoonjoo-park.github.io/react/setStateAsync/"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-dark.css"><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&amp;family=Roboto" rel="stylesheet"><link href="https://fonts.googleapis.com/css2?family=Do+Hyeon&amp;family=Roboto" rel="stylesheet"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=G-0RF6Y2B0CN" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'G-0RF6Y2B0CN');</script><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 5.4.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="Hoon&#039;s 블로그" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-9-tablet is-9-desktop is-9-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-02-19T16:05:40.000Z" title="2022. 2. 20. 오전 1:05:40">2022-02-20</time></span><span class="level-item"><a class="link-muted" href="/categories/%ED%94%84%EB%A1%A0%ED%8A%B8%EC%97%94%EB%93%9C/">프론트엔드</a><span> / </span><a class="link-muted" href="/categories/%ED%94%84%EB%A1%A0%ED%8A%B8%EC%97%94%EB%93%9C/React/">React</a></span><span class="level-item" id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span>&nbsp;visits</span></div></div><h1 class="title is-3 is-size-4-mobile">setState의 비동기적 특성과 Dependency</h1><div class="content"><hr>
<p><img src="https://user-images.githubusercontent.com/67448481/154808670-f614787d-7816-4dc9-8730-9bf8388fc5d4.png"></p>
<h2 id="🐤-setState의-특성"><a href="#🐤-setState의-특성" class="headerlink" title="🐤 setState의 특성"></a>🐤 setState의 특성</h2><blockquote>
<p><code>setState</code>는 비동기적으로 동작한다.<br>그리고 <code>state</code>의 업데이트를 매 <code>setState</code>마다 수행하지 않고, 여러 요청이 들어올 때 한 번의 취합과정을 통해 단 한 번 수행한다.</p>
</blockquote>
<p>이는 <code>state</code>가 변경될 때마다 리렌더링되는 React의 특성 때문이다. <code>setState</code>가 거의 동시에 4<del>5개 발생했을 경우 4</del>5번의 리렌더링을 방치하는 것보다, 한 번의 업데이트를 통해 한 번의 리렌더링이 될 수 있도록 설계되어 있기 때문이다.</p>
<p>즉, React는 16ms 텀을 기준으로 <code>state</code>를 일괄 업데이트를 진행하여, 렌더링이 한 번만 될 수 있도록 하여 효율성을 증진시킨다.</p>
<blockquote>
<p>우선, nodemodules에 접근해 react의 소스코드를 한번 확인해봤다.</p>
</blockquote>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// nodemodules/react/umd/react.development.js</span></span><br><span class="line"></span><br><span class="line">Component.prototype.setState = <span class="function"><span class="keyword">function</span> (<span class="params">partialState, callback</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!(<span class="keyword">typeof</span> partialState === <span class="string">&#x27;object&#x27;</span> || <span class="keyword">typeof</span> partialState === <span class="string">&#x27;function&#x27;</span> || partialState == <span class="literal">null</span>)) &#123;</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="built_in">Error</span>( <span class="string">&quot;setState(...): takes an object of state variables to update or a function which returns an object of state variables.&quot;</span> );</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">this</span>.updater.enqueueSetState(<span class="built_in">this</span>, partialState, callback, <span class="string">&#x27;setState&#x27;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// nodemodules/react/index.d.ts</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useState</span>&lt;<span class="title">S</span>&gt;(<span class="params">initialState: S | (() =&gt; S)</span>): [<span class="title">S</span>, <span class="title">Dispatch</span>&lt;<span class="title">SetStateAction</span>&lt;<span class="title">S</span>&gt;&gt;]</span>;</span><br></pre></td></tr></table></figure>

<p>위에서 보면 알 수 있듯이, <code>setState</code>의 매개변수에는 <code>partialState</code>와 <code>callback</code>이 들어간다. 그리고 partialState에는 <code>object</code>와 <code>function</code> 타입이 들어갈 수 있는 것으로 보인다. 그리고 이후에 setState가 발동될 때마다 현재의 <code>partialState</code>와 인자로 넘어온 <code>partialState</code>를 병합해준다.</p>
<p>그리고 useState의 매개변수에는 prevState(<code>S</code>) 또는 함수형(<code>()⇒ S</code>)이 들어갈 수 있다.</p>
<p>따라서 한번에 여러번 <code>state</code>를 업데이트해야 할 경우, 그리고 동기적으로 setState를 사용하고 싶다면 <code>setCount(prev ⇒ prev+1)</code>과 같이 <code>setState</code> 내부에 함수형으로 선언을 해줘야 한다.</p>
<hr>
<h2 id="🐛-useCallback에서의-dependency-결여로-인한-문제점"><a href="#🐛-useCallback에서의-dependency-결여로-인한-문제점" class="headerlink" title="🐛 useCallback에서의 dependency 결여로 인한 문제점"></a>🐛 useCallback에서의 dependency 결여로 인한 문제점</h2><blockquote>
<p>이번 프로젝트에서는 <code>&lt;input&gt;</code>의 <code>value</code> <code>state</code>가 변경될 때마다 API호출이 일어나야 했고, 해당 <code>value</code>를 <code>req</code>에 담아 <code>Get</code>요청을 보내야 했다.</p>
</blockquote>
<p>하지만, <code>onChange</code> 이벤트가 발생할 때마다 <code>state</code>가 업데이트 되고, 이러한 <code>setState</code>의 과정은 비동기적이고 dependency 처리를 해줘야 했기 때문에, 계속 API request에 담겨지는 <code>inputValue</code>값이 default값인 <code>‘’</code> 로만 인식되어 담겨졌다.</p>
<p>이러한 문제가 발생하는 이유가 궁금해 setState의 비동기적 특성과 dependency 등에 대한 궁금증이 생겼고, 차근차근 하나부터 공부해보고자 결심했다.</p>
<p><strong>문제점</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fetcher = useCallback(</span><br><span class="line">  <span class="keyword">async</span> (entry) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (list.length &lt; <span class="number">1</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">const</span> target = entry[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">if</span> (target.isIntersecting) &#123;</span><br><span class="line">      setRange(<span class="function">(<span class="params">prev</span>) =&gt;</span> prev + <span class="number">15</span>);</span><br><span class="line">      <span class="keyword">const</span> products = <span class="keyword">await</span> axios.get(<span class="string">`api/productList`</span>, &#123;</span><br><span class="line">        <span class="attr">params</span>: &#123; <span class="attr">length</span>: range, <span class="attr">text</span>: inputValue &#125;,</span><br><span class="line">      &#125;);</span><br><span class="line">      setResults(products.data.requests);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  [list]</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>위의 코드는 잘 작동된다. 하지만 처음에 작성했던 코드에서는 useCallback dependency에 <code>list</code>를 추가해두지 않았기 때문에 <code>list.length</code> 값을 default값인 0으로만 인식했다.</p>
<p>useCallback의 특성상, 함수의 참조값이 기준없이 초기화되는 것을 방지하기 위해 반드시 dependency를 추가해줘야 한다. 그래야 해당 dependency를 참조하며 해당 값의 변화를 감지하고, 해당 값의 변화가 있을 때에만 콜백함수의 참조값이 초기화 되기 때문이다.</p>
<p>이에 따라, list의 길이가 변경될 때마다 함수의 참조값이 초기화 되어 새로운 list.length의 값을 새로 불러들여 활용할 수 있도록 <code>dependency</code>에 list <code>props</code>를 넣어주며 문제를 해결했다.</p>
<hr>
</div><div class="article-licensing box"><div class="licensing-title"><p>setState의 비동기적 특성과 Dependency</p><p><a href="https://hoonjoo-park.github.io/react/setStateAsync/">https://hoonjoo-park.github.io/react/setStateAsync/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>Hoonjoo</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2022-02-20</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2022-02-20</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/%EA%B0%9C%EB%85%90/">개념</a></div><div class="sharethis-inline-share-buttons"></div><script src="https://platform-api.sharethis.com/js/sharethis.js#property=61ccb08ffa9c81001d245598&amp;product=sticky-share-buttons" defer></script></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/react/infiniteScroll/"><span class="level-item">React에서의 무한스크롤 (IntersectionObserver)</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">Comments</h3><script src="https://utteranc.es/client.js" repo="hoonjoo-park/hoonjoo-park.github.io" issue-term="pathname" label="🙋‍♂️" theme="github-light" crossorigin="anonymous" async></script></div></div></div><div class="column column-left is-3-tablet is-3-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="level is-mobile" href="#🐤-setState의-특성"><span class="level-left"><span class="level-item">1</span><span class="level-item">🐤 setState의 특성</span></span></a></li><li><a class="level is-mobile" href="#🐛-useCallback에서의-dependency-결여로-인한-문제점"><span class="level-left"><span class="level-item">2</span><span class="level-item">🐛 useCallback에서의 dependency 결여로 인한 문제점</span></span></a></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="Hoon&#039;s 블로그" height="28"></a><p class="is-size-7"><span>&copy; 2022 Hoonjoo</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">총 방문자 <span id="busuanzi_value_site_uv"></span> 명</span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/hoonjoo-park"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>